# ⚠️ 文档已过时：Skip 逻辑已移除

## 重要说明

**此文档描述的逻辑已经不再使用。**

在移除 `skip` 字段后，客户端逻辑已经简化：

## 当前设计

### 设计原则

**上层（containerd）在调用 `Writer()` 之前已经检查过资源是否存在。**

如果资源已存在，就不会调用 `Writer()`，因此：
- 服务端不再返回 `skip=true`
- 客户端不再处理 `Skipped` 字段
- 操作成功时，客户端返回错误，提示上层检查资源是否已存在

### 当前流程

```
contentv2.Store.Writer()
    ↓
client.ClusterLock()
    ↓
tryLockOnce()
    ├─ 获得锁 (acquired=true) → 直接返回 ✅
    ├─ 有错误 → 返回错误 ❌
    └─ 未获得锁 → waitForLock() [SSE订阅等待]
         ├─ 建立 SSE 订阅连接
         ├─ 等待服务端推送事件
         └─ 处理事件：
            ├─ 操作成功 → 返回错误，提示上层检查资源
            └─ 操作失败 → 再次尝试获取锁
```

### 关键变化

1. **服务端**：操作已完成且成功时，直接清理锁，不返回 `skip`
2. **客户端**：操作成功事件时，返回错误，提示上层检查资源是否已存在
3. **contentv2**：只检查 `Acquired` 和 `Error`，不再检查 `Skipped`

## 参考文档

请参考最新的流程文档：
- `docs/客户端逻辑/CLIENT_LOCK_FLOW.md` - 完整的客户端锁获取流程

## 历史记录

此文档原本解释为什么需要 `Skipped` 判断，但在移除 `skip` 字段后，这些逻辑已经不再需要。
